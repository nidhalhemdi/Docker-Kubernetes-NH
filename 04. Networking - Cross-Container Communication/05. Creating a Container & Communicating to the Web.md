# **Creating a Container & Communicating to the Web (WWW)**

### **Goal of the Lecture**

* Dockerize the demo Node.js API.
* Test if a container can communicate with:
  ✔ The **World Wide Web**
  ✘ The **host machine** (MongoDB) → currently failing
* Understand that **WWW communication works out of the box**.

---

# ✅ **Step-by-Step Summary**

### **1. Prepare the Project**

We stop the locally running Node app, then deletes:

* `node_modules/`
* `package-lock.json`

Why?
Because once containerized, these files will be created **inside** the container, not on the host.

---

# **2. Build the Docker Image**

There is already a Dockerfile provided (standard Node.js Dockerfile).

Command used:

```bash
docker build -t favorites-node .
```

* Image name: `favorites-node`
* Tag: `latest` (automatically applied)

---

# **3. Run the Container**

Initial run:

```bash
docker run --name favorites -d --rm -p 3000:3000 favorites-node
```

Explanation:

* `--name favorites` → name container
* `-d` → detached mode
* `--rm` → container is removed when stopped
* `-p 3000:3000` → expose port 3000 container → port 3000 host
* No volumes/bind mounts used here.

---

# **4. Container Crashes**

Checking running containers:

```bash
docker ps
```

No container is shown because `--rm` removed it after failure.

Run in **non-detached mode** to see the error:

```bash
docker run --name favorites -p 3000:3000 favorites-node
```

### ❌ Error:

`MongoNetworkError` → the Node.js app failed connecting to MongoDB.

**Reason:**
MongoDB is running on the **host machine**, not inside the container.
Using `localhost` inside the container **does NOT** point to your host machine.

**Important takeaway:**
➡ **Container → host communication using `localhost` fails by default.**

---

# **5. Remove DB connection temporarily (to test WWW access)**

We comment out the MongoDB connection (`mongoose.connect(...)`) and move:

```js
app.listen(3000)
```

outside of that block.

Then rebuild the image:

```bash
docker build -t favorites-node .
```

Run updated container:

```bash
docker run --name favorites -d --rm -p 3000:3000 favorites-node
```

Now `docker ps` shows the container running.

---

# **6. Test the endpoints**

Test requests:

### ✔ Works (WWW communication):

* `/movies`
* `/people`

These endpoints call the **external Star Wars API**, not the local DB.

Example:

```bash
GET http://localhost:3000/movies
GET http://localhost:3000/people
```

They succeed.

---

# **7. Final Key Insight**

### **Containers can communicate with the Web by default.**

No special configuration is needed.

✔ Outbound HTTP requests → **work immediately**
✘ Accessing host machine (MongoDB) → **does NOT work** (requires special configuration, covered later)

---

# **Important Definitions**

* **Outbound communication**: Requests from the container → the internet.
* **Local host communication**: Requests from the container → services on your machine.
* **Failing DB connection**: Because `localhost` inside the container refers to the container itself, *not the host*.

---

# **Practical Tips**

* Don’t include databases in app containers unless necessary. Use separate containers.
* Rebuild images whenever source code changes.
* Use `docker ps` and non-detached mode to debug container errors.
* If a container fails immediately, remove `-d` to see logs.

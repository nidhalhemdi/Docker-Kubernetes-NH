# **Making Container ‚Üí Host Communication Work**

### **Core Issue**

* Your Node.js app **inside the container** must connect to a **MongoDB database installed on the host machine**.
* Using `localhost` **inside the container** fails.

Why?
Because **inside a container**, `localhost` refers to the **container itself**, not your computer.

---

# ‚úÖ **The Solution**

### ‚úî Use the special Docker hostname:

```txt
host.docker.internal
```

This is a **Docker-reserved domain** that maps to the **host machine‚Äôs IP** from inside the container.

You replace:

```js
mongoose.connect('mongodb://localhost:27017/some-db');
// ‚ùå Does NOT work inside containers
```

With:

```js
mongoose.connect('mongodb://host.docker.internal:27017/some-db');
// ‚úî Works from inside container ‚Üí host machine
```

---

# üîß **Steps**

### **1. Uncomment / Restore MongoDB connection code**

Reactivate:

```js
mongoose.connect(...)
```

### **2. Stop running container**

Because the code changed:

```bash
docker stop favorites
```

### **3. Modify the code**

Replace `localhost` with:

```text
host.docker.internal
```

No Docker run flags need to change.

---

# **4. Rebuild the Image**

```bash
docker build -t favorites-node .
```

### **5. Run the container again**

```bash
docker run --name favorites -d --rm -p 3000:3000 favorites-node
```

### **6. Test the API**

Request:

```
GET http://localhost:3000/favorites
```

Result:
‚úî Successfully retrieves data from MongoDB running on the host.

This confirms:

* Container ‚Üí host communication **works** when using `host.docker.internal`.

---

# üß† **Key Concepts to Remember**

### **1. `localhost` inside a container = the container**

Not your host machine.

### **2. `host.docker.internal` maps to host machine**

* Works on Windows, macOS, and modern Linux (Docker Desktop).
* Easily allows containers to access local services.

### **3. Only code changes are needed**

No new Docker flags, no network setup.

### **4. Use this for ANY host-running service**

Not only MongoDB:

* Local APIs
* Local MySQL/Postgres
* Local Redis
* Any TCP/HTTP service on host

---

# üéØ **Practical Tips**

* After changing source code, always rebuild the Docker image.
* Use `docker ps` to verify container stays running.
* If database is on the host, use `host.docker.internal` as hostname.
* This is an *intermediate step*‚Äîlater you‚Äôll run MongoDB *inside* a container (which is the best practice).

# **Kubernetes: Restarting Containers**

This lecture explains how Kubernetes automatically **detects and restarts failing containers** inside a Podâ€”**as long as the Pod was created through a Deployment** (or anything with a ReplicaSet).

---

# 1ï¸âƒ£ **Triggering a Crash**

In the example:

* The Node.js app includes a `/error` route.
* Visiting this route **throws an error** â†’ the Node server stops â†’ the container also stops (because the containerâ€™s main process dies).

So when the container crashes, Kubernetes responds.

---

# 2ï¸âƒ£ **What Happens After the Crash?**

After triggering `/error`:

### âœ” If you run:

```
kubectl get pods
```

Youâ€™ll see:

* The Pod status might briefly show as **Error**
* Then returns to **Running**
* With the **RESTARTS** counter increased

Example:

```
NAME         READY   STATUS    RESTARTS   AGE
first-app    1/1     Running   2          5m
```

This means:

â–¶ Kubernetes did **not** delete the Pod
â–¶ Kubernetes did **not** create a new Pod
â–¶ Kubernetes **restarted the container inside the same Pod**

---

# 3ï¸âƒ£ **Restart Backoff Policy (Exponential Backoff)**

Kubernetes prevents endless crash-restart loops.

If the container keeps failing:

* Restart delays get **longer and longer**
* Example timing: 10s â†’ 20s â†’ 40s â†’ 80sâ€¦

This behavior is handled by the **kubelet** using the restart policy `Always` (default for Deployments).

---

# 4ï¸âƒ£ **Why Does This Happen?**

Because the workload was created with a **Deployment**.

Deployments ensure:

* Pods are monitored
* Containers are automatically restarted if they exit
* Desired state is preserved (ReplicaSet ensures the right number of Pods)

If this Pod had been created manually with:

```
kubectl run
```

â€¦then the restart behavior depends on the restart policy, but Deployments guarantee `restartPolicy: Always`.

---

# 5ï¸âƒ£ **Dashboard View**

In the Kubernetes dashboard:

* Pod shows **Restart Count** (e.g., 2)
* Events log shows:

  * Container creation
  * Container crash
  * Pod restarting the container

Kubernetes does **container recreation**, not Pod recreation.

---

# 6ï¸âƒ£ **Key Concept: Pod vs Container**

* **Pod** = wrapper
* **Container** = actual running app

When a container crashes:

* The **Pod stays alive**
* The container is **recreated inside the same Pod**

---

# ğŸ“Œ **Important Takeaways**

* Kubernetes automatically restarts failing containers (restartPolicy=Always).
* Restart delays increase over time to prevent infinite crash loops.
* Deployments give you resilience: Kubernetes keeps your app running.
* A container crash â‰  a Pod crash â†’ Pod remains, container is restarted.

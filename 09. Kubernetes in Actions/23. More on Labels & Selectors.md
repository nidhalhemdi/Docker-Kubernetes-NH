# More on Labels & Selectors in Kubernetes

Selectors are a **core Kubernetes concept**. They allow you to connect or group resources:

* Deployments select **Pods**
* Services select **Pods**
* CLI commands can select **resources** by label

This lecture goes deeper into how selectors work.

---

# 1️⃣ Recap: Two Types of Label Selectors

### 1. **Basic label selector**

Used by older Kubernetes resources like **Service**:

```yaml
selector:
  app: second-app
```

### 2. **Modern selector syntax** (supports matchLabels and matchExpressions)

Used by newer resources like **Deployment**:

```yaml
selector:
  matchLabels:
    app: second-app
```

Both methods ultimately select Pods **based on their labels**, not on their names.

---

# 2️⃣ matchExpressions — More Powerful & Flexible

`matchExpressions` is available only on resources that support the newer selector syntax (e.g., Deployments).

Example structure:

```yaml
selector:
  matchExpressions:
    - key: app
      operator: In
      values:
        - second-app
        - first-app
```

Each expression has:

* **key** → a label key (like `app`)
* **operator** → one of:

  * `In`
  * `NotIn`
  * `Exists`
  * `DoesNotExist`
* **values** → a list of accepted label values (used with `In` or `NotIn`)

### Example logic:

* `In` → select Pods whose `app` is one of the listed values
* `NotIn` → select Pods whose `app` is *not* in that list
* `Exists` → select Pods that contain the label key
* `DoesNotExist` → select Pods missing the label key

### ⚠️ Important

A Deployment **must** select the Pods it creates.
Otherwise, Kubernetes treats it as invalid.

---

# 3️⃣ Do You Need matchExpressions?

Usually **no**.
`matchLabels` is simpler and almost always sufficient.

`matchExpressions` is only needed when:

* you want multiple possible values
* you need "not in" or “does not exist”
* you need advanced filtering

---

# 4️⃣ Selectors Are Always Based on **Labels**, Not Names

You *cannot* use:

* name
* namespace
* annotations

Selectors only match resources using **labels** inside `metadata.labels`.

---

# 5️⃣ Using Selectors in kubectl Commands

Selectors work outside YAML too, e.g. for deleting resources.

### Example: deleting by label

First, add labels to Deployment and Service:

```yaml
metadata:
  labels:
    group: example
```

Apply the changes, then delete them by selector:

```
kubectl delete deployments,services -l group=example
```

Notes:

* `-l` means “label selector”
* you must specify resource kinds (`deployments,services`)
* the selector format uses `key=value`

This deletes all Deployments and Services that have `group: example`.

---

# 6️⃣ Why Use Label-Based Deletion?

Because in real projects you often want to:

* delete a whole group of components
* avoid touching other unrelated resources
* handle multiple environments (dev, test, prod) cleanly

For example, all dev resources may have:

```
env=dev
```

Then:

```
kubectl delete all -l env=dev
```

---

# 7️⃣ Key Takeaways

✔ Selectors connect resources by **labels**
✔ Two selector styles: basic vs. matchExpressions
✔ matchExpressions = more power, rarely needed
✔ You can delete resources using label selectors
✔ Label selectors always operate on metadata.labels
✔ Deployment selectors must match the Pods they create

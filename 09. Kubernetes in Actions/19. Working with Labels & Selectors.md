# Working With Labels & Selectors (Kubernetes Deployment)

When applying the `deployment.yaml`, Kubernetes showed this error:

```
error: missing required field "selector"
```

This lecture explains **why** and shows how to fix it.

---

# 1️⃣ Why Do We Need a Selector?

A **Deployment** must know **which pods it controls**.

Even though the Deployment *creates* the pods using the `template`, Kubernetes treats Deployments as **dynamic controllers**:

* If you **scale** replicas later, new pods appear
* If a pod is deleted, the Deployment may recreate it
* The Deployment must continuously **watch the cluster** for pods that belong to it

Because Kubernetes clusters may contain many pods (from multiple deployments), Kubernetes cannot simply assume:

> “Every pod created by this file belongs to the deployment.”

Instead, the Deployment explicitly selects pods based on **labels**.

---

# 2️⃣ Labels = Identifiers

You already added pod labels inside the pod template:

```yaml
template:
  metadata:
    labels:
      app: second-app
```

Labels are **key/value pairs** that can be:

* `app: second-app`
* `tier: backend`
* or anything you choose

Pods can have multiple labels.

---

# 3️⃣ Selectors = Rules that Match Pods by Label

Inside the Deployment `spec`, at the same level as `replicas` and `template`, you must add:

```yaml
selector:
  matchLabels:
    app: second-app
```

This instructs Kubernetes:

> “Control any pod that has the label `app: second-app`.”

If the pod template includes more labels (e.g. `tier: backend`), you can also match on several labels:

```yaml
selector:
  matchLabels:
    app: second-app
    tier: backend
```

Kubernetes will then only manage pods that match **all** these key/value label pairs.

---

# 4️⃣ Important Notes

### ✔ Labels and selectors must match exactly

If your pod template has:

```yaml
labels:
  app: second-app
```

Then your selector *must* include:

```yaml
matchLabels:
  app: second-app
```

Otherwise the Deployment **will not find its own pods**.

### ✔ You can add more labels to pods than you match

But you cannot match labels that don’t exist in the pod template.

---

# 5️⃣ What Happens After Adding the Selector?

Once you add the correct `selector` and re-apply the file:

```
kubectl apply -f deployment.yaml
```

You see:

* Deployment created
* Pod created
* No imperative `kubectl create deployment …` needed
* All configuration is now stored in the YAML file

You now have a fully valid **declarative Deployment**.

At this point, the app is not yet reachable because **a Service** has not been created.
The next lecture covers creating a declarative Service file.

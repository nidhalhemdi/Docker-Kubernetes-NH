# **Diving into the Compose File Configuration**

---

# üöÄ Goal of This Lecture

You learn how to **translate a long `docker run` command into a cleaner Docker Compose configuration**, starting with the **MongoDB service**.

---

# üß± 1. Translate the Old `docker run` Command to Compose

Original command included:

* `--name`
* `-d` (detached)
* `--rm`
* `--network`
* `-e` (environment variables)
* `-v` (volume)
* image name (`mongo`)

Compose simplifies ALL of this.

---

# üìå 2. MongoDB Service Configuration (Key Concepts)

### ‚úî **Image**

In Compose:

```yaml
image: "mongo"
```

Equivalent of:

```
docker run mongo
```

You can use:

* local images
* hub images
* private registry images
* custom images you built

---

# ‚úî 3. You Don‚Äôt Need Detach Mode or Auto-Remove Here

Compose handles:

* removal of containers with `docker compose down`
* detached mode with:

  ```
  docker compose up -d
  ```

So **no need to specify these flags inside the YAML file.**

---

# üì¶ 4. Volumes

Use the `volumes:` key to specify persistent named volumes.

Example:

```yaml
volumes:
  - data:/data/db
```

Meaning:

* **data** ‚Üí name of the Docker-managed persistent volume
* `/data/db` ‚Üí path inside the Mongo container

Same syntax as `docker run -v data:/data/db`.

---

# üîë 5. Environment Variables (Two Ways)

### A. **YAML object style** (recommended)

```yaml
environment:
  MONGO_INITDB_ROOT_USERNAME: nidhal
  MONGO_INITDB_ROOT_PASSWORD: secret
```

### B. **Array style** (valid alternative)

```yaml
environment:
  - MONGO_INITDB_ROOT_USERNAME=nidhal
  - MONGO_INITDB_ROOT_PASSWORD=secret
```

If the format is **key: value**, no dashes.
If it's a **single string**, you need dashes.

---

# üìÅ 6. Using an `.env` File (Optional)

Create file:

```
env/mongo.env
```

Contents:

```
MONGO_INITDB_ROOT_USERNAME=nidhal
MONGO_INITDB_ROOT_PASSWORD=secret
```

In Compose:

```yaml
env_file:
  - ./env/mongo.env
```

Useful when:

* you want to keep secrets out of Git
* you want cleaner compose files

---

# üåê 7. Networks (Important!)

By default:

> **Docker Compose automatically creates a private network and connects all services to it.**

Therefore:

‚úî You **don‚Äôt need to define a network**
‚úî You **don‚Äôt need to attach services manually**

Unless you want custom networks (rare at this stage), skip it.

---

# üì¶ 8. Named Volumes Must Be Declared at Top Level

Important rule:

> Every **named volume** used by services must be registered at the bottom of the compose file.

Example:

```yaml
volumes:
  data:
```

This tells Docker Compose:

* ‚ÄúPlease create a volume named `data` if it does not exist.‚Äù

No value is needed after the colon.

Bind mounts and anonymous volumes **do not** need registration.

---

# ‚≠ê Final MongoDB Compose Configuration (Result of This Lecture)

```yaml
version: "3.8"

services:
  mongodb:
    image: "mongo"
    volumes:
      - data:/data/db
    environment:
      MONGO_INITDB_ROOT_USERNAME: nidhal
      MONGO_INITDB_ROOT_PASSWORD: secret

volumes:
  data:
```

This replaces the entire long `docker run` command!

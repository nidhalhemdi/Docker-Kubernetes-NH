# **Building Our Own Image with a Dockerfile**

## üîπ Purpose of a Dockerfile

A **Dockerfile** defines *how to build your custom image*:

* What base image to use
* What files to copy
* What commands to run during build
* What command should run when a container starts

Docker reads the Dockerfile **line by line** and uses it as a recipe to create an image.

---

# **1. Create the Dockerfile**

Create a file named:

```
Dockerfile
```

(Docker auto-detects this name.)

Optional: Install VS Code ‚ÄúDocker‚Äù extension for syntax help.

---

# **2. Start With a Base Image**

```dockerfile
FROM node
```

* Uses the official Node.js image from Docker Hub
* Can be local or remote ‚Äî Docker finds it automatically
* Most Dockerfiles start with a base image instead of ‚Äúfrom scratch‚Äù

---

# **3. Set a Working Directory**

```dockerfile
WORKDIR /app
```

Why:

* By default Docker runs commands from `/`
* Our app files should live in `/app`
* All later instructions (COPY, RUN, CMD) use this directory automatically

---

# **4. Copy Project Files Into the Image**

```dockerfile
COPY . /app
```

Meaning:

* First `.` ‚Üí local folder where Dockerfile exists
* Second `/app` ‚Üí destination inside the image
* Excludes Dockerfile itself
* Copies folder, files, subfolders (including `/public`, `server.js`, `package.json`)

*Best practice:* Use absolute paths to avoid confusion.

---

# **5. Install Dependencies Using `RUN`**

```dockerfile
RUN npm install
```

Important notes:

* `RUN` executes **during image build**
* Installs dependencies *inside the image*, not on your machine
* Runs inside `/app` because of the `WORKDIR`

---

# **6. Expose Port 80 to the Host**

```dockerfile
EXPOSE 80
```

Why:

* The Node.js server listens on port **80 inside the container**
* Without exposing it, your host can‚Äôt access the web server
* Just a declaration ‚Äî actual mapping happens later with `docker run`

---

# **7. Define the Start Command (for containers)**

**Do NOT use `RUN` here** ‚Äî `RUN` executes at build time.

Use **CMD** to define what runs **when a container launches**:

```dockerfile
CMD ["node", "server.js"]
```

Reason:

* CMD runs **every time a container starts**
* Allows multiple containers to run the Node server from the same image
* Correct syntax uses an array of strings

---

# **üìå Final Dockerfile (clean version)**

```dockerfile
FROM node
WORKDIR /app
COPY . /app
RUN npm install
EXPOSE 80
CMD ["node", "server.js"]
```

---

# **üîπ Critical Concepts Recap**

### **RUN vs CMD**

| Instruction | When It Runs          | Purpose                                             |
| ----------- | --------------------- | --------------------------------------------------- |
| **RUN**     | During image build    | Install packages, compile code, prepare environment |
| **CMD**     | When container starts | Start the actual application                        |

### **Workdir**

* Sets working directory for all following commands
* Only affects *subsequent* lines

### **Container Isolation**

* Even if app listens on port 80, host can‚Äôt reach it until:

  * `EXPOSE 80` in Dockerfile
  * `-p hostPort:containerPort` when running container (next lecture)
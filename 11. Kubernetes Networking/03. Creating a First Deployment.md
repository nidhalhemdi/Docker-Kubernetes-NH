# **Creating a First Deployment**

---

# **1. Prep Work**

### **Make sure Minikube is running**

```bash
minikube status
minikube start --driver=<driver>
```

### **Check cluster is clean**

```bash
kubectl get deployments
kubectl get services
```

(Only the default Kubernetes service should be present.)

---

# **2. Start With the Users API**

You begin Kubernetes setup with **only the Users API**, because:

* It normally depends on the Auth API.
* You temporarily remove its dependency (to simplify deployment).

---

# **3. Temporarily Modify the Users API Code**

In **users-app.js**, comment out outgoing Axios requests to the Auth API and replace them with dummy responses.

### **For `/signup` route**

* Comment out Axios request.
* Return a **dummy string** instead.

### **For `/login` route**

* Comment out Axios request.
* Return a dummy object:

```js
{
  status: 200,
  data: {
    token: "dummy-token"
  }
}
```

These changes make the Users API **fully independent** for now.
(You’ll revert this later.)

---

# **4. Build & Push Users API Docker Image**

### **Create a repo on Docker Hub**

Example name: `kub-demo-users`

### **Build image**

From inside the **users-api** folder:

```bash
docker build -t <dockerhub-username>/kub-demo-users .
```

### **Push the image**

```bash
docker push <dockerhub-username>/kub-demo-users
```

This image will be pulled by Minikube for Kubernetes deployment.

---

# **5. Create Kubernetes Folder & Deployment File**

Make a folder to store all manifests:

```
kubernetes/
```

Add file:

```
users-deployment.yaml
```

---

# **6. users-deployment.yaml – Full Structure**

This YAML defines:

* Deployment
* Pod template
* Labels
* Container
* Docker image to use

### **Template**

```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: users-deployment
spec:
  replicas: 1
  selector:
    matchLabels:
      app: users
  template:
    metadata:
      labels:
        app: users
    spec:
      containers:
        - name: users
          image: <dockerhub-username>/kub-demo-users
```

Key points:

* `replicas: 1` → one pod for now
* `selector.matchLabels` must match pod `metadata.labels`
* Container name is arbitrary
* Image must match your Docker Hub image

---

# **7. Apply the Deployment**

Navigate correctly:

```bash
cd users-api/kubernetes
kubectl apply -f users-deployment.yaml
```

This:

* Creates the deployment
* Starts 1 pod running the Users API container

---

# **8. What You Should See**

Check pod status:

```bash
kubectl get pods
kubectl describe pod <pod-name>
```

Deployment is now live in the cluster.

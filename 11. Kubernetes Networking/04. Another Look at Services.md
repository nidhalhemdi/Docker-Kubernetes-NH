# **Another Look at Services**

---

# **1. Why We Need a Service**

We want to access the **Users API** from outside the cluster (e.g., Postman, browser, frontend app).

A **Kubernetes Service** gives us two essential things:

### ✅ **1. Stable network address**

* Pods get new IPs when restarted — unreliable.
* Services expose a **stable virtual IP (ClusterIP)** that never changes.

### ✅ **2. Optional outside-world access**

* Pods cannot be reached from outside by default.
* Services can expose ports externally based on the **service type**.

---

# **2. Service Types (Important Recap)**

### **1. ClusterIP (default)**

* Internal-only
* Used for pod-to-pod communication
* Offers load balancing *inside the cluster*
* **NOT externally reachable**

### **2. NodePort**

* Exposes service on each node’s IP at a fixed port
* Still not ideal for multi-node clusters (IP changes, not stable)
* Rarely used in production

### **3. LoadBalancer (most useful)**

* Gets an **external IP**
* Balances traffic across pods on any node
* Cloud providers create a real load balancer automatically
* In Minikube: you use `minikube service` to simulate this

➡️ **LoadBalancer = external IP + load balancing + stable access**

---

# **3. Create users-service.yaml**

This service exposes the Users API to the outside.

### **Key elements:**

* `selector`: which pods belong to the service (must match pod labels)
* `type`: LoadBalancer (for external access)
* `ports`:

  * `port`: external port
  * `targetPort`: pod/container internal port (User API listens on 8080)

---

# **4. YAML Structure**

```yaml
apiVersion: v1
kind: Service
metadata:
  name: users-service
spec:
  type: LoadBalancer
  selector:
    app: users
  ports:
    - protocol: TCP
      port: 8080         # external port
      targetPort: 8080   # container port
```

This service:

* Finds pods labeled `app: users`
* Exposes their port **8080** to the outside world

---

# **5. Apply the Service**

```bash
kubectl apply -f users-service.yaml
```

---

# **6. Accessing the Service in Minikube**

Since Minikube does NOT create real cloud load balancers, you must run:

```bash
minikube service users-service
```

This:

* Opens the service URL in your browser
* Gives you a working external URL (copy it)

Example URL:

```
http://127.0.0.1:52314
```

---

# **7. Test the Users API**

Use Postman or similar, send requests to the Minikube service URL:

### **Login**

```
POST /login
Body:
{
  "email": "test@test.com",
  "password": "123"
}
```

Should return a dummy token.

### **Signup**

```
POST /signup
Body:
{
  "email": "test@test.com",
  "password": "123"
}
```

Should return `"User created"`.

If JSON is malformed → receive error responses.

---

# **8. Key Takeaways**

* Services are essential for **network stability** and **external access**.
* `LoadBalancer` is the main service type for production traffic.
* Even with a single pod, you *still need a service* to expose it.
* Minikube simulates real load balancers using `minikube service`.

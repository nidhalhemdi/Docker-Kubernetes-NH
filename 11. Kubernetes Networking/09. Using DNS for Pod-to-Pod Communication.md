# **Using DNS for Pod-to-Pod Communication**

---

# **Kubernetes Pod-to-Pod Communication Using DNS**

Kubernetes offers *three* ways for pods to reach other services:

1. **Manual service IPs** (static but annoying to manage)
2. **Auto-generated env variables** (dynamic but verbose)
3. **DNS-based service names** (**BEST and recommended**)

This lecture focuses on **Option 3: DNS resolution via CoreDNS**.

---

# üß© **Key Concepts (Simple Definitions)**

### **CoreDNS**

A built-in Kubernetes DNS service that automatically creates **internal domain names** for every Kubernetes service.

This allows communication like:

```
http://auth-service.default
```

instead of manually finding IP addresses.

---

### **Cluster-Internal DNS**

* Only works *inside the cluster*
* Not accessible from your local machine
* Used by pods to contact other services

---

### **Service DNS Naming Pattern**

```
<service-name>.<namespace>
```

Since you are using the default namespace, it becomes:

```
auth-service.default
```

---

# üîß **How to Use It**

### Step 1 ‚Äî Replace IP or env var with service DNS name

Example for AUTH_ADDRESS (Node.js or any language):

```env
AUTH_ADDRESS=auth-service.default
```

### Step 2 ‚Äî Update the deployment

```
kubectl apply -f users-deployment.yaml
```

### Step 3 ‚Äî Test your requests

Nothing changed in your code except the value passed to the env var.

Signup route ‚Üí Now using DNS
Login route ‚Üí Still using auto env variable (as demonstration)

Both still work ‚Üí proves CoreDNS resolves service names.

---

# üìå **Important Notes**

* **Works in any programming language** (DNS ‚â† language-specific).
* **Same idea as Docker Compose using service names**, but now provided by CoreDNS inside Kubernetes.
* **Namespace matters**

  * If not specified, everything goes into `default`
  * You can list namespaces:

    ```
    kubectl get namespaces
    ```

---

# üí° **Why DNS Is the Best Method**

‚úî No need to fetch IPs
‚úî No manual updates
‚úî Works automatically when pods restart
‚úî Cleanest configuration
‚úî Recommended in real production clusters

---

# üõ†Ô∏è **Useful Commands Mentioned**

| Purpose                                 | Command                                                     |
| --------------------------------------- | ----------------------------------------------------------- |
| See available namespaces                | `kubectl get namespaces`                                    |
| Apply updated deployment                | `kubectl apply -f users-deployment.yaml`                    |
| Restart deployment by deleting old pods | `kubectl delete deployment users-deployment` (then `apply`) |

---

# üìù **Mini Cheat Sheet**

```
# Service-to-service communication (recommended):

<service-name>.<namespace>

Example:
auth-service.default
```

Use this inside an environment variable to call another service.
# Defining a Persistent Volume (PV)

A **Persistent Volume (PV)** is a cluster-wide storage resource that exists *independently* of Pods and Nodes.
Unlike regular volumes (defined inside a Pod), a PV is its own Kubernetes object.

In this lecture, we define one using the **hostPath** type â€” only suitable for minikube (single node), but the concepts apply to all PV types.

---

# ðŸ“Œ 1. Create a PV YAML File

The file is named:

```
host-pv.yaml
```

This file defines a **PersistentVolume** object.

---

# ðŸ“Œ 2. Basic Structure of a Persistent Volume

Hereâ€™s the core skeleton:

```yaml
apiVersion: v1
kind: PersistentVolume
metadata:
  name: host-pv
spec:
  ...
```

* `apiVersion: v1` â†’ PVs belong to the core API.
* `kind: PersistentVolume` â†’ must be spelled exactly like this.
* `metadata.name` â†’ your chosen PV name.

---

# ðŸ“Œ 3. PV Spec â€” Main Configuration

Below `spec:` you define HOW your storage behaves.

### **A. Choose a Volume Type**

For this demo: **hostPath**

```yaml
spec:
  hostPath:
    path: /data
    type: DirectoryOrCreate
```

This works only because minikube = 1 node.
In real clusters, youâ€™d use AWS EBS, Azure Disk, NFS, CSI, etc.

---

### **B. Define Capacity**

PVs must declare how much storage they offer:

```yaml
capacity:
  storage: 1Gi
```

Pods will later request some amount via a PVC.
The PV must have **equal or more** capacity.

---

### **C. Volume Mode**

Two modes exist:

1. **Filesystem** â†’ typical folder-based storage
2. **Block** â†’ raw block device

For hostPath, you must use:

```yaml
volumeMode: Filesystem
```

---

### **D. Access Modes**

Access modes determine how Pods can access the PV:

| Mode                    | Meaning                                                                       |
| ----------------------- | ----------------------------------------------------------------------------- |
| **ReadWriteOnce (RWO)** | One *node* can read/write (multiple Pods OK as long as they run on same node) |
| **ReadOnlyMany (ROX)**  | Many nodes may read                                                           |
| **ReadWriteMany (RWX)** | Many nodes may read/write                                                     |

For **hostPath**, only **ReadWriteOnce** is allowed (because hostPath only exists on one node).

So we define:

```yaml
accessModes:
  - ReadWriteOnce
```

---

# âœ” Final Structure

Hereâ€™s what the full PV YAML looks like (conceptually):

```yaml
apiVersion: v1
kind: PersistentVolume
metadata:
  name: host-pv
spec:
  capacity:
    storage: 1Gi
  volumeMode: Filesystem
  accessModes:
    - ReadWriteOnce
  hostPath:
    path: /data
    type: DirectoryOrCreate
```

This creates a standalone persistent storage resource in the cluster â€” *not tied to any Pod*.

---

# ðŸ§  Key Takeaways

### âœ” Persistent Volumes are cluster-level storage

Not defined in Pods, not destroyed with Pods.

### âœ” PVs must specify:

* storage type (hostPath, AWS, Azure, NFS, CSI...)
* capacity
* volume mode (Filesystem / Block)
* access modes (RWO / ROX / RWX)

### âœ” PVs can be used by any Pod

But Pods donâ€™t use PVs directly â€” they use **Persistent Volume Claims (PVCs)**.

PVCs match with PVs based on:

* access modes
* storage requirements
* storage class (optional)

This matching will be explained in the next lecture.

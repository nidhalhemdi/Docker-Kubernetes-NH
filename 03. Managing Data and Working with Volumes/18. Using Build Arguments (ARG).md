# **Using Build Arguments (ARG)**

Build arguments allow you to pass **dynamic values at build time**, making your Dockerfile flexible **without changing its code**.

They are different from **environment variables**, which are set at runtime.

---

# ğŸ”§ **What Are Build Arguments (ARG)?**

* **Used during image build (docker build)**
* Can **NOT** be accessed in application code (unlike ENV)
* Can **ONLY** be used in the Dockerfile
* Only apply to instructions **after** the `ARG` definition
* Common use case: Setting default values dynamically

---

# ğŸŒŸ **Example Scenario: Making the default port flexible**

Currently:

```dockerfile
ENV PORT=80
```

The value `80` is hard-coded.
We want this default port to be configurable **without editing the Dockerfile**.

---

# ğŸš€ **Step 1 â€” Define an ARG**

```dockerfile
ARG default_port=80
```

* `default_port` is available **during `docker build` only**
* Has a default value (`80`) but can be overridden

---

# ğŸš€ **Step 2 â€” Use ARG inside ENV**

```dockerfile
ENV PORT=$default_port
```

This means:

* When building the image, `$default_port` becomes the default value for `PORT`
* The `PORT` env variable becomes available to the running container

**IMPORTANT:**
Arguments can set values for environment variables, but **not the other way around**.

---

# ğŸ§ª **Building Images With and Without ARG Values**

### **Default build (uses default_port = 80)**

```
docker build -t feedback-node:web-app .
```

### **Build with a custom port (override default_port)**

```
docker build -t feedback-node:dev \
  --build-arg default_port=8000 .
```

Now you have **two images**, same Dockerfile:

* `feedback-node:web-app` â†’ default port = 80
* `feedback-node:dev` â†’ default port = 8000

No Dockerfile changes needed.

---

# ğŸ§  **Key Behavior to Remember**

### âœ” ARG values are **locked into the image during build**

Once built, the default environment value is fixed *unless* overridden at runtime using:

```
docker run -e PORT=<value>
```

---

# âš ï¸ **IMPORTANT: ARG placement matters**

Every Dockerfile instruction creates a **layer**.

If you place:

```dockerfile
ARG default_port
```

**above** `RUN npm install`, then:

* Changing the ARG value forces all **subsequent layers** to rebuild
* That means **npm install runs again**, which is slow

Soâ€¦
â— **Place ARG just above the line where it is needed**
to avoid unnecessary rebuilds.

Example:

```dockerfile
# Install deps
COPY package.json .
RUN npm install

# Use build argument AFTER npm install
ARG default_port=80
ENV PORT=$default_port
```

This way:

* Changing default_port **does not** re-trigger npm install
* Faster rebuilds
* More efficient caching

---

# ğŸ¯ **When Should You Use ARG?**

Use `ARG` when:

* Values are needed **during build**, not runtime
* You want to build **multiple image variants** from a single Dockerfile
  (e.g., dev, staging, production)
* You want to avoid editing the Dockerfile repeatedly

Use `ENV` when:

* The application needs access to the value at runtime
* You want to change the value without rebuilding the image

---

# ğŸ”‘ **ARG vs ENV â€“ Quick Comparison**

| Feature                       | ARG               | ENV                  |
| ----------------------------- | ----------------- | -------------------- |
| Available at build time       | âœ”                 | âœ”                    |
| Available at runtime          | âœ˜                 | âœ”                    |
| Available inside app code     | âœ˜                 | âœ”                    |
| Can be overridden at build    | âœ” (`--build-arg`) | âœ” (with new ENV)     |
| Can be overridden at run      | âœ˜                 | âœ” (`-e` or env-file) |
| Cached layer triggers rebuild | Yes               | Yes                  |


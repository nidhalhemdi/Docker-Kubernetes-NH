# What You Just Did (And Why It Failed)

You added this to the Dockerfile:

```dockerfile
VOLUME ["/app/feedback"]
```

This **tells Docker**:

> â€œCreate a volume and mount it to `/app/feedback` inside the container.â€

### But hereâ€™s the important part:

**Docker automatically creates an *anonymous* volume.**
You did *not* control or specify where this data should go.

So Docker decides:

* to create a new folder *somewhere* on your host
* attach it as a volume
* use it only for this new container

And every time you start a new container that uses `VOLUME`â€¦

ğŸ‘‰ **Docker creates a brand-new anonymous volume.**

That means your new container is **not connected** to the volume created by the previous container.

So the data from the last container is still storedâ€”but in some old anonymous volume that the newly started container **does not use**.

This is why:

### âŒ Your file was NOT persisted

### âŒ But no data was actually deleted

### âœ” Itâ€™s just stored somewhere else, in a volume not attached to the new container

This explains why volumes seemed to â€œnot work.â€

---

# âš ï¸ Why The Rename Error Happened

Before persistence failed, you hit an earlier error:

### â€œCross-device link is not permittedâ€

This happened because:

* The **temp folder** is inside the container filesystem
* The **feedback folder** is now on a Docker-managed volume
* Nodeâ€™s `fs.rename()` cannot move a file between two different â€œdevicesâ€

So Docker made `/app/feedback` live on a **different storage layer**, and Node didnâ€™t like moving files across devices.

Thatâ€™s why switching to:

```js
fs.copyFile()
fs.unlink()
```

fixed the issue.

---

# ğŸ§  So why didnâ€™t the VOLUME instruction give us persistence?

Because **anonymous volumes** behave like this:

* Created automatically
* Unique per container
* Automatically orphaned when container is removed

Therefore:

* First container writes into anonymous volume A
* You remove the container
* Start a new container â†’ Docker creates anonymous volume B
* Your new container is linked to B (which is empty)
* Volume A still has your data, but **no container uses it**

This is why:

â¡ï¸ The file never appears in the new container
â¡ï¸ Docker didnâ€™t â€œloseâ€ the data
â¡ï¸ You just canâ€™t reach it anymore

---

# ğŸ¯ What Youâ€™re Meant to Learn From This Lecture

The instructor is **intentionally showing you a failure** to make a point:

### ğŸ”‘ The `VOLUME` instruction inside the Dockerfile is **almost never what you want**

**because you cannot control the host folder or the volume name.**

Real persistence requires:

### âœ” **Named volumes**

or

### âœ” **Bind mounts**

Both of which are created at runtime using:

```bash
-v myvolume:/app/feedback
```

This attaches the same volume every time you recreate containers.

---

# ğŸ“Œ Summary of the Lecture

| Concept                      | What Happened               | Why                                               |
| ---------------------------- | --------------------------- | ------------------------------------------------- |
| Added `VOLUME /app/feedback` | Created an anonymous volume | Docker auto-creates unnamed volumes               |
| Node rename error            | Crash occurred              | Moving file across devices is not allowed         |
| Switched to copy/unlink      | Fixed code-level error      | Copy + delete works across devices                |
| Restart container            | Data gone                   | New container got a *new* anonymous volume        |
| Previous data still exists   | Yes                         | But in an old volume the container no longer uses |


# **Adding Docker Networks for Efficient Cross-Container Communication**

---

# ğŸ¯ **Goal**

Connect MongoDB, the Node backend, and the React frontend **efficiently** using a Docker networkâ€”without relying on published ports for container-to-container communication.

---

# ğŸ”Œ **1. Create a Docker Network**

List networks:

```sh
docker network ls
```

Create a network:

```sh
docker network create goals-net
```

This network allows containers to:

* communicate using **container names** instead of IPs,
* avoid publishing internal ports unnecessarily,
* isolate traffic inside the application.

---

# ğŸ—„ï¸ **2. Start MongoDB Inside the Network (NO PORTS)**

```sh
docker run --name mongodb \
  --rm \
  --network goals-net \
  mongo
```

We **donâ€™t** publish ports because:

* other containers can reach Mongo via `mongodb:27017` inside the network
* we donâ€™t access Mongo from the host directly

---

# ğŸ§  **Important Change: Backend must connect to MongoDB using the container name**

Old (WRONG now):

```js
mongodb://host.docker.internal:27017
```

Correct:

```js
mongodb://mongodb:27017
```

Because inside the network:

* Docker resolves `mongodb` â†’ containerâ€™s internal IP.

---

# ğŸ³ **3. Rebuild and Run the Backend Inside the Network**

Rebuild backend image:

```sh
docker build -t goals-node .
```

Run backend:

```sh
docker run --name goals-backend \
  --rm \
  --network goals-net \
  -p 80:80 \
  goals-node
```

Why publish port 80?

* **Because React (running in the browser) needs to call the backend via `localhost:80`.**
* Browser JavaScript cannot resolve Docker container names.

---

# ğŸ¨ **4. Update React Code â€” The Important Concept**

React code runs **in the browser**, not in the container.

### âŒ WRONG

```js
fetch("http://goals-backend/goals")
```

A browser CANNOT resolve Docker container names.

### âœ” CORRECT

```js
fetch("http://localhost/goals")
```

Because:

* backend published port 80 â†’ available on your host at `localhost:80`
* browser knows what `localhost` is

---

# ğŸ› ï¸ Rebuild the React Image

```sh
docker build -t goals-react .
```

---

# ğŸ–¥ï¸ Run React Container

```sh
docker run --name goals-frontend \
  --rm -it \
  -p 3000:3000 \
  goals-react
```

### Why no `--network`?

Because:

* React dev server doesnâ€™t need to talk directly to backend or DB
* Its JS code runs in browser â†’ it goes through **host localhost**, not Docker

---

# ğŸ§© **Final Working Setup**

| Component          | In Docker Network?      | Port Published?   | Who Contacts It? |
| ------------------ | ----------------------- | ----------------- | ---------------- |
| **MongoDB**        | Yes                     | No                | Backend only     |
| **Backend (Node)** | Yes                     | Yes (`80:80`)     | React (browser)  |
| **React**          | No (network irrelevant) | Yes (`3000:3000`) | Browser loads it |

---

# ğŸ” Why React Cannot Use Docker Container Names

Because the React **JavaScript code** runs:

âœ” in the **browser**
âœ– NOT in the container

Docker DNS translation works **only inside containers** â†’ not accessible to browsers.

So the browser must use:

* `http://localhost:80`

Not:

* `http://goals-backend`

---

# ğŸ‰ **End Result of This Lecture**

You now have:
âœ” MongoDB and backend communicating using Docker network
âœ” Backend reachable via `localhost` so the browser can call it
âœ” React container running dev server
âœ” All containers cleanly separated
âœ” Correct understanding of the tricky React networking behavior

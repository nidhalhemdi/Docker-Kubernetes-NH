# **Dockerizing the Node App (Backend)**

## **ðŸŽ¯ Goal**

Put the **Node.js backend (REST API)** into its own Docker container, make it communicate with the MongoDB container, and ensure the React frontend (still running locally) can talk to it.

---

# **1. Stop Locally Running Backend**

```bash
CTRL + C
```

---

# **2. Create the Backend Dockerfile**

### **Dockerfile:**

```dockerfile
FROM node:latest

WORKDIR /app

COPY package.json .

RUN npm install

COPY . .

EXPOSE 80

CMD ["node", "app.js"]
```

**Purpose of each step:**

* Use Node base image
* Create working dir
* Copy package.json â†’ install deps
* Copy rest of the code
* Expose port 80 (the port the Node app listens to)
* Start the app

---

# **3. Build the Backend Image**

Clean old images (optional):

```bash
docker image prune -a
```

Build:

```bash
docker build -t goals-node .
```

---

# **4. Run the Backend Container**

Initial run (foreground):

```bash
docker run --name goals-backend --rm goals-node
```

### â— The backend crashes

**Why?**
Because inside the container, `localhost` points to **the container itself**, not your host machine.

Your Node code still tries to connect to MongoDB via:

```
mongodb://localhost:27017
```

But the MongoDB database is running **on the host mapped port**.

---

# **5. Fix the MongoDB Connection**

Use:

```
host.docker.internal
```

This special DNS entry maps to your **real host machine IP**.

### Update connection string in backend code:

```
mongodb://host.docker.internal:27017
```

---

# **6. Rebuild the Image**

Because the source code changed:

```bash
docker build -t goals-node .
```

Run again:

```bash
docker run --name goals-backend --rm goals-node
```

Now it successfully connects to MongoDB.

---

# **7. New Problem: React Frontend Cannot Connect**

You see:

* â€œSomething went wrongâ€
* Browser dev tools: **ERR_CONNECTION_REFUSED**

Reason:
The backend container uses port 80 *internally* but you didnâ€™t publish it to the host.

> `EXPOSE` in Dockerfile **does NOT publish ports**.

---

# **8. Publish Backend Port**

Stop the container:

```bash
docker stop goals-backend
```

Run with port mapping:

```bash
docker run -d --name goals-backend --rm -p 80:80 goals-node
```

Now:

* Frontend (on localhost:3000) â†’ can reach backend (localhost:80)
* Backend â†’ can reach MongoDB (through host.docker.internal:27017)

---

# **âœ” Result**

2/3 services are now dockerized:

* **MongoDB container**
* **Node.js backend container**

React app (running locally) now works again:

* Fetch goals
* Add goal
* Delete goal

Next step: Dockerize the **frontend**.
